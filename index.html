<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ledger App</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="header-bar">
    <button id="return-btn" onclick="goBack()">返回</button>
    <h1 id="app-title">Xiaoxin's Ledger App</h1>
  </div>

  <!-- Login / Signup Section -->
  <div id="login-section" class="section">
    <h2 id="login-title">登录或注册</h2>
    <input type="text" id="username" placeholder="邮箱">
    <input type="password" id="password" placeholder="密码">
    <div class="actions">
      <button id="signup-btn" onclick="signup()">注册</button>
      <button id="login-btn" onclick="login()">登录</button>
    </div>
    <div class="forgot-password">
      <button id="forgot-btn" onclick="forgotPassword()">重置密码</button>
    </div>
    <small id="reset-hint" class="reset-hint">
      如需重置密码，请先输入您的邮箱地址并点击重置按钮，然后查看您的邮箱，按照邮件中的提示完成操作。
    </small>

    <div id="login-settings" class="login-settings">
      <div id="login-lang-switch" class="login-lang-switch">
        <p>语言 / Language</p>
        <button class="settings-button" onclick="setLanguage('zh', true)">中文</button>
        <button class="settings-button" onclick="setLanguage('en', true)">English</button>
      </div>

      <div id="login-fontsize-change" class="login-fontsize-change">
        <p>字体大小</p>
        <button class="settings-button" onclick="decreaseFontsize()">-</button>
        <button class="settings-button" onclick="increaseFontsize()">+</button>
      </div>
    </div>

  </div>

  <div class="pages-wrapper" id="pages-wrapper">
    <!-- Home Section -->
    <div class="page" id="home-page">
      <div class="home-hero">
        <div class="home-image-wrapper">
          <img id="home-image" src="" alt="Custom picture">
          <div class="home-overlay">
            <div id="home-month">11月·结余</div>
            <div id="home-balance">收入 - 支出</div>
            <div id="home-summary">本月收入 0 | 本月支出 0</div>
          </div>
        </div>
      </div>
      <div class="kanban">
        <div class="kanban-row">
          <div class="kanban-left">
            <div class="kanban-title" id="kanban-today-title">今天</div>
            <div class="kanban-sub" id="today-sub">最新交易</div>
          </div>
          <div class="kanban-right">
            <div id="today-income" class="income">收入 0.00</div>
            <div id="today-expense" class="expense">支出 0.00</div>
          </div>
        </div>
        <hr>
        <div class="kanban-row">
          <div class="kanban-left">
            <div class="kanban-title" id="kanban-month-title">本月</div>
            <div class="kanban-sub" id="month-sub">11月 1日–30日</div>
          </div>
          <div class="kanban-right">
            <div id="month-income" class="income">收入 0.00</div>
            <div id="month-expense" class="expense">支出 0.00</div>
          </div>
        </div>
        <hr>
        <div class="kanban-row">
          <div class="kanban-left">
            <div class="kanban-title" id="kanban-year-title">本年</div>
            <div class="kanban-sub" id="year-sub">2025</div>
          </div>
          <div class="kanban-right">
            <div id="year-income" class="income">收入 0.00</div>
            <div id="year-expense" class="expense">支出 0.00</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Ledger Section -->
    <div class="page" id="transaction-page">

      <!-- Tabs -->
      <div class="transaction-tabs">
        <button class="tab-btn active" data-index="0">支出</button>
        <button class="tab-btn" data-index="1">收入</button>
        <button class="tab-btn" data-index="2">转账</button>
        <button class="tab-btn" data-index="3">余额</button>
      </div>

      <!-- ✅ Wrapper contains ONLY the 3 pages -->
      <div class="transaction-wrapper" id="transaction-wrapper">

        <!-- Expense -->
        <div class="transaction-page" id="expense-form">
          <form class="transaction-form">
            <div id="expense-amount-row" class="amount-row">
              <button type="button" id="expense-amount" class="amount-button">0.00</button>
              <label id="expense-calculation" class="calculation">2+3</label>
            </div>

            <div id="expense-household-form-row" class="form-row">
              <label>家庭</label>
              <button type="button" id="expense-household" class="selector-button" data-type="household"></button>
            </div>

            <div class="form-row">
              <label>账户</label>
              <button type="button" id="expense-account" class="selector-button" data-type="account"></button>
            </div>

            <div class="form-row">
              <label>时间</label>
              <button type="button" id="expense-datetime" class="selector-button" data-type="datetime"></button>
            </div>

            <div class="form-row">
              <label>成员</label>
              <input list="person-list" id="expense-person">
            </div>

            <div class="form-row">
              <label>类别</label>
              <input type="search" id="expense-category">
            </div>

            <div class="form-row">
              <label>商家</label>
              <input type="search" id="expense-store">
            </div>

            <div class="form-row" id="expense-items-form">
              <label>条目</label>
              <div class="item-group">
                <div class="item-row">
                  <input type="text" class="item-name" placeholder="条目">
                  <input type="text" class="item-notes" placeholder="价格">
                </div>
                <button type="button" id="expense-add-item-btn">Add another item</button>
              </div>
            </div>


            <div class="actions">
              <button type="button" onclick="addEntry('expense')">添加支出</button>
            </div>
          </form>
        </div>

        <!-- Income -->
        <div class="transaction-page" id="income-form">
          <form class="transaction-form">
            <div id="income-amount-row" class="amount-row">
              <button type="button" id="income-amount" class="amount-button">0.00</button>
              <label id="income-calculation" class="calculation"></label>
            </div>

            <div id="income-household-form-row" class="form-row">
              <label>家庭</label>
              <button type="button" id="income-household" class="selector-button" data-type="household"></button>
            </div>

            <div class="form-row">
              <label>账户</label>
              <button type="button" id="income-account" class="selector-button" data-type="account"></button>
            </div>

            <div class="form-row">
              <label>时间</label>
              <button type="button" id="income-datetime" class="selector-button" data-type="datetime"></button>
            </div>

            <div class="form-row">
              <label>成员</label>
              <input list="person-list" id="income-person">
            </div>

            <div class="form-row">
              <label>类别</label>
              <input type="search" id="income-category">
            </div>

            <div class="form-row">
              <label>商家</label>
              <input type="search" id="income-store">
            </div>

            <div class="form-row" id="income-items-form">
              <label>条目</label>
              <div class="item-group">
                <div class="item-row">
                  <div class="item-content">
                    <input type="text" class="item-name" placeholder="条目">
                    <input type="text" class="item-notes" placeholder="价格">
                  </div>
                  <button type="button" class="delete-btn">删除</button>
                </div>
                <button type="button" id="income-add-item-btn">Add another item</button>
              </div>
            </div>

            <div class="actions">
              <button type="button" onclick="addEntry('income')">添加收入</button>
            </div>
          </form>
        </div>

        <!-- Transfer -->
        <div class="transaction-page" id="transfer-form">
          <form class="transaction-form">
            <div id="simple-transfer-amount-row" class="amount-row" style="display:none;">
              <button type="button" id="transfer-amount" class="amount-button">0.00</button>
              <label id="transfer-calculation" class="calculation"></label>
            </div>
            <div id="exchange-transfer-amount-row">
              <label>⇂</label>
              <div id="exchange-transfer-from-amount-row" class="amount-row">
                <label id="transfer-from-currency" class="currency">CAD</label>
                <button type="button" id="transfer-from-amount" class="amount-button">0.00</button>
                <label id="transfer-from-calculation" class="calculation">2+2</label>
                <label id="exchange-rate-from-label">⇂ 汇率：5.10</label>
              </div>
              <div id="exchange-transfer-to-amount-row" class="amount-row">
                <label id="transfer-to-currency" class="currency">USD</label>
                <button type="button" id="transfer-to-amount" class="amount-button">0.00</button>
                <label id="transfer-to-calculation" class="calculation">1+1</label>
                <label id="exchange-rate-to-label">↿ 汇率：0.20</label>
              </div>
            </div>

            <div id="transfer-household-form-row" class="form-row">
              <label>家庭</label>
              <button type="button" id="transfer-household" class="selector-button" data-type="household"></button>
            </div>

            <div class="form-row">
              <label>账户</label>
              <div class="transfer-accounts">
                <div class="transfer-account">
                  <label class="transfer-label">转出</label>
                  <button type="button" id="transfer-from-account" class="selector-button" data-type="account">
                </div>
                <label id="tranfer-between-indicator">⇌</label>
                <div class="transfer-account">
                  <label class="transfer-label">转入</label>
                  <button type="button" id="transfer-to-account" class="selector-button" data-type="account">
                </div>
              </div>
            </div>

            <div class="form-row" id="transfer-notes-form">
              <label>备注</label>
              <input type="text" id="transfer-amount">
            </div>

            <div class="actions">
              <button type="button" onclick="addEntry('transfer')">添加转账</button>
            </div>
          </form>
        </div>

        <!-- Balance -->
        <div class="transaction-page" id="balance-form">
          <form class="transaction-form">
            <div id="balance-amount-row" class="amount-row">
              <button type="button" id="balance-amount" class="amount-button">0.00</button>
              <label id="balance-calculation" class="calculation"></label>
            </div>

            <div id="balance-household-form-row" class="form-row">
              <label>家庭</label>
              <button type="button" id="balance-household" class="selector-button" data-type="household"></button>
            </div>

            <div class="form-row">
              <label>账户</label>
              <button type="button" id="balance-account" class="selector-button" data-type="account">
            </div>

            <div class="form-row">
              <label>时间</label>
              <button type="button" id="balance-datetime" class="selector-button" data-type="datetime"></button>
            </div>

            <div class="form-row" id="balance-notes-form">
              <label>备注</label>
              <input type="text" id="balance-amount">
            </div>

            <div class="actions">
              <button type="button" onclick="addEntry('balance')">设定余额</button>
            </div>
          </form>
        </div>

      </div>

      <ul id="ledger-list"></ul>
    </div>

    <!-- Selector panels -->
    <div id="household-selector" class="selector">
      <button type="button" class="datetime-close"
        onclick="document.getElementById('household-selector').style.transform = 'translateY(120%)'">收起 ▼</button>

      <div class="dt-col household-col"></div>
    </div>

    <div id="datetime-selector" class="selector">
      <button type="button" class="datetime-now" onclick=clickToSetNow()>现在</button>
      <button type="button" class="datetime-close"
        onclick="document.getElementById('datetime-selector').style.transform = 'translateY(120%)'">收起 ▼</button>

      <div class="dt-col year-col"></div>
      <div class="dt-col month-col"></div>
      <div class="dt-col day-col"></div>
      <div class="dt-col hour-col"></div>
      <div class="dt-col minute-col"></div>
    </div>
  </div>

  <!-- Settings Section -->
  <div class="page" id="settings-page">
    <div class="settings-header">
      <h2 id="settings-title">设置</h2>
      <span id="settings-welcome"></span>
    </div>

    <!-- Language -->
    <section class="settings-section lang-switch">
      <p>语言 / Language</p>
      <button class="settings-button" onclick="setLanguage('zh', true)">中文</button>
      <button class="settings-button" onclick="setLanguage('en', true)">English</button>
    </section>

    <!-- Language -->
    <section class="settings-section fontsize-change">
      <p>字体大小</p>
      <button class="settings-button" onclick="decreaseFontsize()">-</button>
      <button class="settings-button" onclick="increaseFontsize()">+</button>
    </section>

    <!-- Color scheme -->
    <section class="settings-section color-switch">
      <p id="color-scheme-title">颜色方案</p>
      <select id="color-scheme-select" onchange="setColorScheme(this.value, true)">
        <option value="default">收入红 / 支出绿</option>
        <option value="alt">收入绿 / 支出红</option>
      </select>
    </section>

    <!-- Homepage images -->
    <section class="settings-section home-image">
      <p id="home-image-title">首页图</p>
      <div id="home-image-actions">
        <button id="manage-home-image-btn" class="settings-button">Manage</button>
        <div id="home-image-panel" style="display:none;">
          <p id="home-image-instruction">您可在此处添加您想要使用的在线图片链接。</p>
          <div id="home-image-list"></div>
          <div class="home-image-controls">
            <button id="add-home-image-btn" type="button">Add</button>
            <button id="save-home-image-btn" type="button">Save</button>
          </div>
        </div>
      </div>
    </section>


    <!-- Household -->
    <section class="settings-section household-row">
      <p>我的家庭</p>
      <div id="household-actions">
        <button id="rename-btn" class="settings-button">重命名我的家庭</button>
        <div id="rename-panel" class="panel hidden">
          <input id="rename-household">
          <button id="rename-confirm" class="settings-button primary">确认修改</button>
        </div>

        <button id="invite-btn" class="settings-button">邀请加入我的家庭</button>
        <div id="invite-panel" class="panel hidden">
          <p>注意：受邀用户只能加入您创建的家庭，不能加入您受邀参与的家庭。</p>
          <input id="invite-email" type="email" placeholder="输入对方的邮箱">
          <button id="invite-confirm" class="settings-button primary">确认邀请</button>
        </div>

        <button id="manage-btn" class="settings-button">从我的家庭中移除用户</button>
        <div id="manage-panel" class="panel hidden">
          <h4>成员管理</h4>
          <ul id="member-list" class="household-list"></ul>
        </div>

        <button id="leave-btn" class="settings-button">将我从他人的家庭中移除</button>
        <div id="leave-household-panel" class="panel hidden">
          <h4>他人的家庭</h4>
          <ul id="leave-household-list" class="household-list"></ul>
        </div>
      </div>
    </section>

    <div class="actions">
      <button type="button" id="logout-btn" class="secondary" onclick="logout()">退出登录</button>
    </div>
  </div>

  <!-- Bottom Navigation Bar -->
  <nav class="bottom-nav" style="display:none;">
    <button id="nav-home" onclick="showPage('home', 'nav-home')">首页</button>
    <button id="nav-accounts" onclick="showPage('accounts', 'nav-accounts')">账户</button>
    <button id="nav-transaction" onclick="showPage('transaction', 'nav-transaction')">记一笔</button>
    <button id="nav-values" onclick="showPage('values', 'nav-values')">价值</button>
    <button id="nav-settings" onclick="showPage('settings', 'nav-settings')">设置</button>
  </nav>


  <div id="statusMessage"></div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>

  <!-- App Logic -->
  <script src="script.js"></script>
</body>

</html>