<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ledger App</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="header-bar">
    <button id="return-btn" onclick="goBack()">返回</button>
    <h1 id="app-title">Xiaoxin's Ledger App</h1>
  </div>

  <!-- Login / Signup Section -->
  <div id="login-section" class="section">
    <h2 id="login-title">登录或注册</h2>
    <input type="text" id="username" placeholder="邮箱">
    <input type="password" id="password" placeholder="密码">
    <div class="actions">
      <button id="signup-btn" onclick="signup()">注册</button>
      <button id="login-btn" onclick="login()">登录</button>
    </div>
  </div>
  <div id="login-lang-switch" class="login-lang-switch">
    <p>语言 / Language</p>
    <button onclick="setLanguage('en', true)">English</button>
    <button onclick="setLanguage('zh', true)">中文</button>
  </div>

  <div class="pages-wrapper" id="pages-wrapper">
    <!-- Home Section -->
    <div class="page" id="home-page">
      <div class="home-hero">
        <div class="home-image-wrapper" oncontextmenu="triggerHomeUpload(event)" onmousedown="handleHold(event)">
          <img id="home-image" src="" alt="Custom picture">
          <input type="file" id="home-image-upload" accept="image/*" style="display:none;"
            onchange="previewHomeImage(event)">
          <div class="home-overlay">
            <div id="home-month">11月·结余</div>
            <div id="home-balance">收入 - 支出</div>
            <div id="home-summary">本月收入 0 | 本月支出 0</div>
          </div>
        </div>
      </div>
      <div class="kanban">
        <div class="kanban-row">
          <div class="kanban-left">
            <div class="kanban-title" id="kanban-today-title">今天</div>
            <div class="kanban-sub" id="today-sub">最新交易</div>
          </div>
          <div class="kanban-right">
            <div id="today-income" class="income">收入 0.00</div>
            <div id="today-expense" class="expense">支出 0.00</div>
          </div>
        </div>
        <hr>
        <div class="kanban-row">
          <div class="kanban-left">
            <div class="kanban-title" id="kanban-month-title">本月</div>
            <div class="kanban-sub" id="month-sub">11月 1日–30日</div>
          </div>
          <div class="kanban-right">
            <div id="month-income" class="income">收入 0.00</div>
            <div id="month-expense" class="expense">支出 0.00</div>
          </div>
        </div>
        <hr>
        <div class="kanban-row">
          <div class="kanban-left">
            <div class="kanban-title" id="kanban-year-title">本年</div>
            <div class="kanban-sub" id="year-sub">2025</div>
          </div>
          <div class="kanban-right">
            <div id="year-income" class="income">收入 0.00</div>
            <div id="year-expense" class="expense">支出 0.00</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Ledger Section -->
    <div class="page" id="transaction-page">

      <!-- Tabs -->
      <div class="transaction-tabs">
        <button class="tab-btn active" data-index="0">支出</button>
        <button class="tab-btn" data-index="1">收入</button>
        <button class="tab-btn" data-index="2">转账</button>
      </div>

      <!-- ✅ Wrapper contains ONLY the 3 pages -->
      <div class="transaction-wrapper" id="transaction-wrapper">

        <!-- Expense -->
        <div class="transaction-page" id="expense-form">
          <form class="transaction-form">
            <div class="form-row">
              <label>账户</label>
              <input list="account-list" id="expense-account">
            </div>

            <div class="form-row">
              <label>时间</label>
              <button type="button" id="expense-datetime" class="selector-button" data-type="datetime"></button>
            </div>

            <div class="form-row">
              <label>成员</label>
              <input list="person-list" id="expense-person">
            </div>

            <div class="form-row">
              <label>家庭</label>
              <button type="button" id="expense-household" class="selector-button" data-type="household"></button>
            </div>

            <div class="form-row">
              <label>类别</label>
              <input type="search" id="expense-category">
            </div>

            <div class="form-row">
              <label>商家</label>
              <input type="search" id="expense-store">
            </div>

            <div class="form-row" id="items-form">
              <label>条目</label>
              <div class="item-group">
                <div class="item-row">
                  <input type="text" class="item-name" placeholder="条目">
                  <input type="text" class="item-notes" placeholder="价格">
                </div>
                <button type="button" id="expense-add-item-btn">Add another item</button>
              </div>
            </div>


            <div class="actions">
              <button type="button" onclick="addEntry('expense')">添加支出</button>
            </div>
          </form>
        </div>

        <!-- Income -->
        <div class="transaction-page" id="income-form">
          <form class="transaction-form">
            <div class="form-row">
              <label>账户</label>
              <input list="account-list" id="income-account">
            </div>

            <div class="form-row">
              <label>时间</label>
              <button type="button" id="income-datetime" class="selector-button" data-type="datetime"></button>
            </div>

            <div class="form-row">
              <label>成员</label>
              <input list="person-list" id="income-person">
            </div>

            <div class="form-row">
              <label>家庭</label>
              <button type="button" id="income-household" class="selector-button" data-type="household"></button>
            </div>

            <div class="form-row">
              <label>类别</label>
              <input type="search" id="income-category">
            </div>

            <div class="form-row">
              <label>商家</label>
              <input type="search" id="income-store">
            </div>

            <div class="form-row" id="items-form">
              <label>条目</label>
              <div class="item-group">
                <div class="item-row">
                  <div class="item-content">
                    <input type="text" class="item-name" placeholder="条目">
                    <input type="text" class="item-notes" placeholder="价格">
                  </div>
                  <button type="button" class="delete-btn">删除</button>
                </div>
                <button type="button" id="income-add-item-btn">Add another item</button>
              </div>
            </div>

            <div class="actions">
              <button type="button" onclick="addEntry('income')">添加收入</button>
            </div>
          </form>
        </div>

        <!-- Transfer -->
        <div class="transaction-page" id="transfer-form">
          <form class="transaction-form">
            <div class="actions">
              <button type="button" onclick="addEntry('transfer')">添加转账</button>
            </div>
          </form>
        </div>

      </div>

      <ul id="ledger-list"></ul>
    </div>

    <!-- Selector panels -->
    <div id="household-selector" class="selector">
      <button type="button" class="datetime-close"
        onclick="document.getElementById('household-selector').style.display='none'">收起 ▼</button>

      <div class="dt-col household-col"></div>
    </div>

    <div id="datetime-selector" class="selector">
      <button type="button" class="datetime-close"
        onclick="document.getElementById('datetime-selector').style.display='none'">收起 ▼</button>

      <div class="dt-col year-col"></div>
      <div class="dt-col month-col"></div>
      <div class="dt-col day-col"></div>
      <div class="dt-col hour-col"></div>
      <div class="dt-col minute-col"></div>
    </div>
  </div>

  <!-- Settings Section -->
  <div class="page" id="settings-page">
    <div class="settings-header">
      <h2 id="settings-title">设置</h2>
      <span id="settings-welcome"></span>
    </div>

    <!-- Language -->
    <section class="settings-section lang-switch">
      <p>语言 / Language</p>
      <button class="settings-button" onclick="setLanguage('en', true)">English</button>
      <button class="settings-button" onclick="setLanguage('zh', true)">中文</button>
    </section>

    <!-- Color scheme -->
    <section class="settings-section color-switch">
      <p>颜色方案 / Color Scheme</p>
      <select id="color-scheme-select" onchange="setColorScheme(this.value, true)">
        <option value="default">收入红 / 支出绿</option>
        <option value="alt">收入绿 / 支出红</option>
      </select>
    </section>

    <!-- Household -->
    <section class="settings-section household-row">
      <p>我的家庭:</p>
      <div id="household-actions">
        <button id="rename-btn" class="settings-button">重命名我的家庭</button>
        <div id="rename-panel" class="panel hidden">
          <input id="rename-household">
          <button id="rename-confirm" class="settings-button primary">确认修改</button>
        </div>

        <button id="invite-btn" class="settings-button">邀请加入我的家庭</button>
        <div id="invite-panel" class="panel hidden">
          <p>注意：受邀用户只能加入您创建的家庭，不能加入您受邀参与的家庭。</p>
          <input id="invite-email" type="email" placeholder="输入对方的邮箱">
          <button id="invite-confirm" class="settings-button primary">确认邀请</button>
        </div>

        <button id="manage-btn" class="settings-button">从我的家庭中移除用户</button>
        <div id="manage-panel" class="panel hidden">
          <h4>成员管理</h4>
          <ul id="member-list" class="household-list"></ul>
        </div>

        <button id="leave-btn" class="settings-button">将我从他人的家庭中移除</button>
        <div id="leave-household-panel" class="panel hidden">
          <h4>他人的家庭</h4>
          <ul id="leave-household-list" class="household-list"></ul>
        </div>
      </div>
    </section>

    <div class="actions">
      <button type="button" id="logout-btn" class="secondary" onclick="logout()">退出登录</button>
    </div>
  </div>

  <!-- Bottom Navigation Bar -->
  <nav class="bottom-nav" style="display:none;">
    <button id="nav-home" onclick="showPage('home-page')">首页</button>
    <button id="nav-accounts" onclick="showPage('accounts-page')">账户</button>
    <button id="nav-transaction" onclick="showPage('transaction-page')">记一笔</button>
    <button id="nav-charts" onclick="showPage('charts-page')">图表</button>
    <button id="nav-settings" onclick="showPage('settings-page')">设置</button>
  </nav>


  <div id="statusMessage"></div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>

  <!-- App Logic -->
  <script src="script.js"></script>
</body>

</html>